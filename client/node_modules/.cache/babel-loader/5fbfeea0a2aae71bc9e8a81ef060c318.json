{"ast":null,"code":"import * as actionTypes from '../actions';\nimport axios from '../../../Axios';\n\nvar logInSuccess = function logInSuccess(token, userId) {\n  return {\n    type: actionTypes.LOG_IN,\n    token: token,\n    userId: userId\n  };\n};\n\nvar checkTokenValidity = function checkTokenValidity(expiresIn) {\n  return function (dispatch) {\n    setTimeout(function () {\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"userId\");\n      localStorage.removeItem(\"expiresIn\");\n      dispatch(logout());\n    }, expiresIn * 1000);\n  };\n};\n\nexport var onLogIn = function onLogIn(data) {\n  return function (dispatch) {\n    axios.post(\"/login\", data).then(function (res) {\n      var _res$data = res.data,\n          userId = _res$data.userId,\n          token = _res$data.token,\n          expiresIn = _res$data.expiresIn;\n      var expirationDate = new Date(new Date().getTime() + expiresIn * 1000);\n      localStorage.setItem(\"token\", token);\n      localStorage.setItem(\"userId\", userId);\n      localStorage.setItem(\"expiresIn\", expirationDate);\n      dispatch(logInSuccess(res.data.token, userId));\n      dispatch(checkTokenValidity(expiresIn));\n    }).catch(function (err) {\n      dispatch(logInFailed(err));\n    });\n  };\n};\n\nvar logInFailed = function logInFailed(err) {\n  return {\n    type: actionTypes.LOG_IN_FAILED,\n    error: err\n  };\n};\n\nvar logout = function logout() {\n  return {\n    type: actionTypes.LOG_OUT\n  };\n};\n\nexport var onLogout = function onLogout() {\n  return function (dispatch) {\n    //delete token saved in local storage\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"userId\");\n    localStorage.removeItem(\"expiresIn\");\n    dispatch(logout());\n  };\n};\n\nvar authSuccess = function authSuccess(token, userId) {\n  return {\n    type: actionTypes.ON_AUTH,\n    token: token,\n    userId: userId\n  };\n};\n\nexport var checkAuthState = function checkAuthState() {\n  return function (dispatch) {\n    var token = localStorage.getItem('token');\n\n    if (!token) {\n      dispatch(logout());\n    } else {\n      var expirationDate = new Date(localStorage.getItem('expiresIn'));\n\n      if (expirationDate <= new Date()) {\n        dispatch(logout);\n      } else {\n        var userId = localStorage.getItem('userId');\n        dispatch(authSuccess(token, userId));\n        dispatch(checkTokenValidity((expirationDate.getTime() - new Date().getTime()) / 1000));\n      }\n    }\n  };\n};\n\nvar registered = function registered() {\n  return {\n    type: actionTypes.ON_REGISTER\n  };\n};\n\nvar registrationFailed = function registrationFailed(err) {\n  return {\n    type: actionTypes.ON_REGISTRATION_FAILED,\n    error: err\n  };\n};\n\nexport var onRegister = function onRegister(data) {\n  return function (dispatch) {\n    axios.post(\"/register\", data).then(function (res) {\n      dispatch(registered());\n    }).catch(function (err) {\n      dispatch(registrationFailed(err));\n    });\n  };\n};","map":{"version":3,"sources":["/Users/Gotzil/Desktop/React/PiperChat/piedpiper/client/src/store/actions/actionCreators/authActionCreators.js"],"names":["actionTypes","axios","logInSuccess","token","userId","type","LOG_IN","checkTokenValidity","expiresIn","dispatch","setTimeout","localStorage","removeItem","logout","onLogIn","data","post","then","res","expirationDate","Date","getTime","setItem","catch","err","logInFailed","LOG_IN_FAILED","error","LOG_OUT","onLogout","authSuccess","ON_AUTH","checkAuthState","getItem","registered","ON_REGISTER","registrationFailed","ON_REGISTRATION_FAILED","onRegister"],"mappings":"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","sourcesContent":["import * as actionTypes from '../actions';\nimport axios from '../../../Axios';\n\nconst logInSuccess = (token, userId) => {\n    return {\n        type: actionTypes.LOG_IN,\n        token: token, \n        userId: userId\n    }\n}\nconst checkTokenValidity = expiresIn => {\n    return dispatch => {\n        setTimeout(() => {\n        localStorage.removeItem(\"token\");\n        localStorage.removeItem(\"userId\");\n        localStorage.removeItem(\"expiresIn\");\n            dispatch(logout());\n        }, expiresIn * 1000);\n    }\n}\nexport const onLogIn = (data) => {\n    return dispatch => {\n        axios.post(\"/login\", data)\n         .then(res => {\n           const { userId, token, expiresIn } = res.data;\n           const expirationDate = new Date (new Date().getTime() + expiresIn * 1000);\n           localStorage.setItem(\"token\", token);\n           localStorage.setItem(\"userId\", userId);\n           localStorage.setItem(\"expiresIn\", expirationDate);\n           dispatch(logInSuccess(res.data.token, userId));\n           dispatch(checkTokenValidity(expiresIn));\n         })\n         .catch(err => {\n             dispatch(logInFailed(err))\n         })\n    }\n}\nconst logInFailed = err => {\n    return {\n        type: actionTypes.LOG_IN_FAILED,\n        error: err \n    }\n}\nconst logout = () => {\n    return {\n        type: actionTypes.LOG_OUT\n    }\n}\n\nexport const onLogout = () => {\n    return dispatch => {\n        //delete token saved in local storage\n        localStorage.removeItem(\"token\");\n        localStorage.removeItem(\"userId\");\n        localStorage.removeItem(\"expiresIn\");\n        dispatch(logout());\n    }\n}\n\nconst authSuccess = (token, userId) => {\n    return {\n        type: actionTypes.ON_AUTH,\n        token: token,\n        userId: userId\n    }\n}\nexport const checkAuthState = () => {\n    return dispatch => {\n        let token = localStorage.getItem('token');\n        if (!token) {\n            dispatch(logout());\n        } else {\n            const expirationDate = new Date (localStorage.getItem('expiresIn'));\n            if (expirationDate <= new Date()){\n                dispatch(logout)\n            } else {\n                const userId = localStorage.getItem('userId');\n                dispatch(authSuccess(token, userId));\n                dispatch(checkTokenValidity((expirationDate.getTime() - new Date().getTime()) / 1000 ));\n            \n            }\n        }\n    }\n}\nconst registered = () => {\n    return {\n        type: actionTypes.ON_REGISTER,\n        \n    }\n}\nconst registrationFailed = err => {\n    return {\n        type: actionTypes.ON_REGISTRATION_FAILED,\n        error: err\n    }\n}\nexport const onRegister = data => {\n    return dispatch => {\n        axios.post(\"/register\", data)\n            .then(res => {\n                dispatch(registered())\n            })\n            .catch(err => {\n                dispatch(registrationFailed(err))\n            });\n    }\n}"]},"metadata":{},"sourceType":"module"}