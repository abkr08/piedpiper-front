{"ast":null,"code":"import _classCallCheck from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/gotzil/Downloads/social-media/client/src/containers/Video/Video.js\";\nimport React, { Component } from 'react';\nimport classes from './Video.module.css';\nimport { connect } from 'react-redux';\nimport * as callActionCreators from '../../store/actions/actionIndex';\n\nvar Video =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Video, _Component);\n\n  function Video() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Video);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Video)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      id: null,\n      room: ''\n    };\n\n    _this.endCall = function () {\n      _this.setState({\n        room: undefined\n      }); ///this.props.closeCaller.close();\n\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = _this.localUserMedia.getTracks()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var track = _step.value;\n          track.stop();\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      _this.toggleEndCallButton();\n    };\n\n    _this.endCurrentCall = function () {\n      _this.props.channel.trigger(\"client-endcall\", {\n        room: _this.state.room\n      });\n\n      _this.endCall();\n    };\n\n    _this.toggleEndCallButton = function () {\n      /*  if (document.getElementById(\"endCall\").style.display === \"block\") {\n          document.getElementById(\"endCall\").style.display = \"none\";\n        } else {\n          document.getElementById(\"endCall\").style.display = \"block\";\n        }*/\n    };\n\n    return _this;\n  }\n\n  _createClass(Video, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.props.callUser(this.props.callTo);\n      this.props.channel.bind(\"client-reject\", function (answer) {\n        if (answer.room === _this2.state.room) {\n          console.log(\"Call declined\");\n          alert(\"call to \" + answer.rejected + \"was politely declined\");\n\n          _this2.endCall();\n        }\n      });\n      this.props.channel.bind(\"client-endcall\", function (answer) {\n        if (answer.room === _this2.state.room) {\n          console.log(\"Call Ended\");\n\n          _this2.endCall();\n        }\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.localVideoRef.srcObject = this.props.localStream;\n      this.remoteVideoRef.srcObject = this.props.remoteStream;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(\"div\", {\n        className: classes.Video,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69\n        },\n        __self: this\n      }, React.createElement(\"video\", {\n        autoPlay: true,\n        muted: true,\n        src: this.props.localStream,\n        className: classes.LocalVideo,\n        ref: function ref(lVid) {\n          return _this3.localVideoRef = lVid;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70\n        },\n        __self: this\n      }), React.createElement(\"video\", {\n        autoPlay: true,\n        src: this.props.remoteStream,\n        className: classes.remoteVideo,\n        ref: function ref(rVid) {\n          return _this3.remoteVideoRef = rVid;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Video;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    userId: state.auth.userId,\n    channel: state.call.channel,\n    remoteStream: state.call.remoteStream,\n    localStream: state.call.localStream\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    callUser: function callUser(user, calltype) {\n      return dispatch(callActionCreators.callUser(user, callType));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Video);","map":{"version":3,"sources":["/Users/gotzil/Downloads/social-media/client/src/containers/Video/Video.js"],"names":["React","Component","classes","connect","callActionCreators","Video","state","id","room","endCall","setState","undefined","localUserMedia","getTracks","track","stop","toggleEndCallButton","endCurrentCall","props","channel","trigger","callUser","callTo","bind","answer","console","log","alert","rejected","localVideoRef","srcObject","localStream","remoteVideoRef","remoteStream","LocalVideo","lVid","remoteVideo","rVid","mapStateToProps","userId","auth","call","mapDispatchToProps","dispatch","user","calltype","callType"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAgC,OAAhC;AACA,OAAOC,OAAP,MAAoB,oBAApB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAO,KAAKC,kBAAZ,MAAoC,iCAApC;;IAEMC,K;;;;;;;;;;;;;;;;;UAEFC,K,GAAQ;AACFC,MAAAA,EAAE,EAAE,IADF;AAEFC,MAAAA,IAAI,EAAE;AAFJ,K;;UA2BPC,O,GAAU,YAAM;AACX,YAAKC,QAAL,CAAc;AAACF,QAAAA,IAAI,EAAEG;AAAP,OAAd,EADW,CAEX;;;AAFW;AAAA;AAAA;;AAAA;AAGX,6BAAkB,MAAKC,cAAL,CAAoBC,SAApB,EAAlB,8HAAmD;AAAA,cAA1CC,KAA0C;AACjDA,UAAAA,KAAK,CAACC,IAAN;AACD;AALU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOX,YAAKC,mBAAL;AACD,K;;UAEFC,c,GAAiB,YAAM;AACpB,YAAKC,KAAL,CAAWC,OAAX,CAAmBC,OAAnB,CAA2B,gBAA3B,EAA6C;AAC3CZ,QAAAA,IAAI,EAAE,MAAKF,KAAL,CAAWE;AAD0B,OAA7C;;AAIA,YAAKC,OAAL;AACD,K;;UAGAO,mB,GAAsB,YAAM;AAC7B;;;;;AAKC,K;;;;;;;wCA/Ce;AAAA;;AAEhB,WAAKE,KAAL,CAAWG,QAAX,CAAoB,KAAKH,KAAL,CAAWI,MAA/B;AAEA,WAAKJ,KAAL,CAAWC,OAAX,CAAmBI,IAAnB,CAAwB,eAAxB,EAAyC,UAAAC,MAAM,EAAI;AAC/C,YAAIA,MAAM,CAAChB,IAAP,KAAgB,MAAI,CAACF,KAAL,CAAWE,IAA/B,EAAqC;AACnCiB,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAC,UAAAA,KAAK,CAAC,aAAaH,MAAM,CAACI,QAApB,GAA+B,uBAAhC,CAAL;;AACA,UAAA,MAAI,CAACnB,OAAL;AACD;AACF,OANH;AAQE,WAAKS,KAAL,CAAWC,OAAX,CAAmBI,IAAnB,CAAwB,gBAAxB,EAA0C,UAAAC,MAAM,EAAK;AACnD,YAAIA,MAAM,CAAChB,IAAP,KAAgB,MAAI,CAACF,KAAL,CAAWE,IAA/B,EAAqC;AACnCiB,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;;AACA,UAAA,MAAI,CAACjB,OAAL;AACD;AACF,OALD;AAOL;;;yCA6BqB;AAClB,WAAKoB,aAAL,CAAmBC,SAAnB,GAA+B,KAAKZ,KAAL,CAAWa,WAA1C;AACA,WAAKC,cAAL,CAAoBF,SAApB,GAAgC,KAAKZ,KAAL,CAAWe,YAA3C;AACH;;;6BAES;AAAA;;AAEN,aACI;AAAK,QAAA,SAAS,EAAE/B,OAAO,CAACG,KAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAO,QAAA,QAAQ,MAAf;AAAgB,QAAA,KAAK,MAArB;AAAsB,QAAA,GAAG,EAAE,KAAKa,KAAL,CAAWa,WAAtC;AAAmD,QAAA,SAAS,EAAE7B,OAAO,CAACgC,UAAtE;AAAkF,QAAA,GAAG,EAAE,aAACC,IAAD;AAAA,iBAAS,MAAI,CAACN,aAAL,GAAqBM,IAA9B;AAAA,SAAvF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI;AAAO,QAAA,QAAQ,MAAf;AAAiB,QAAA,GAAG,EAAE,KAAKjB,KAAL,CAAWe,YAAjC;AAA+C,QAAA,SAAS,EAAE/B,OAAO,CAACkC,WAAlE;AAA+E,QAAA,GAAG,EAAE,aAACC,IAAD;AAAA,iBAAS,MAAI,CAACL,cAAL,GAAsBK,IAA/B;AAAA,SAApF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,CADJ;AAMH;;;;EApEepC,S;;AAsEpB,IAAMqC,eAAe,GAAG,SAAlBA,eAAkB,CAAAhC,KAAK,EAAI;AAC7B,SAAO;AACHiC,IAAAA,MAAM,EAAEjC,KAAK,CAACkC,IAAN,CAAWD,MADhB;AAEHpB,IAAAA,OAAO,EAAEb,KAAK,CAACmC,IAAN,CAAWtB,OAFjB;AAGHc,IAAAA,YAAY,EAAE3B,KAAK,CAACmC,IAAN,CAAWR,YAHtB;AAIHF,IAAAA,WAAW,EAAEzB,KAAK,CAACmC,IAAN,CAAWV;AAJrB,GAAP;AAMH,CAPD;;AAQA,IAAMW,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,QAAQ,EAAI;AACnC,SAAO;AACHtB,IAAAA,QAAQ,EAAE,kBAACuB,IAAD,EAAOC,QAAP;AAAA,aAAoBF,QAAQ,CAACvC,kBAAkB,CAACiB,QAAnB,CAA4BuB,IAA5B,EAAkCE,QAAlC,CAAD,CAA5B;AAAA;AADP,GAAP;AAGH,CAJD;;AAKA,eAAe3C,OAAO,CAACmC,eAAD,EAAkBI,kBAAlB,CAAP,CAA6CrC,KAA7C,CAAf","sourcesContent":["import React, { Component} from 'react';\nimport classes from './Video.module.css';\nimport { connect } from 'react-redux';\nimport * as callActionCreators from '../../store/actions/actionIndex'\n\nclass Video extends Component {\n    \n    state = {\n          id: null,\n          room: ''\n    }\n       \n    componentDidMount (){\n          \n        this.props.callUser(this.props.callTo);\n\n        this.props.channel.bind(\"client-reject\", answer => {\n            if (answer.room === this.state.room) {\n              console.log(\"Call declined\");\n              alert(\"call to \" + answer.rejected + \"was politely declined\");\n              this.endCall();\n            }\n          });\n      \n          this.props.channel.bind(\"client-endcall\", answer =>  {\n            if (answer.room === this.state.room) {\n              console.log(\"Call Ended\");\n              this.endCall();\n            }\n          });\n          \n    }\n       \n    \n     endCall = () => {\n          this.setState({room: undefined});\n          ///this.props.closeCaller.close();\n          for (let track of this.localUserMedia.getTracks()) {\n            track.stop();\n          }\n        \n          this.toggleEndCallButton();\n        }\n    \n       endCurrentCall = () => {\n          this.props.channel.trigger(\"client-endcall\", {\n            room: this.state.room\n          });\n    \n          this.endCall();\n        }\n    \n    \n         toggleEndCallButton = () => {\n        /*  if (document.getElementById(\"endCall\").style.display === \"block\") {\n            document.getElementById(\"endCall\").style.display = \"none\";\n          } else {\n            document.getElementById(\"endCall\").style.display = \"block\";\n          }*/\n        }\n    componentDidUpdate () {\n        this.localVideoRef.srcObject = this.props.localStream;\n        this.remoteVideoRef.srcObject = this.props.remoteStream;\n    }\n       \n    render () {\n\n        return (\n            <div className={classes.Video}>\n                <video autoPlay muted src={this.props.localStream} className={classes.LocalVideo} ref={(lVid)=> this.localVideoRef = lVid}  ></video>\n                <video autoPlay  src={this.props.remoteStream} className={classes.remoteVideo} ref={(rVid)=> this.remoteVideoRef = rVid}  ></video>\n            </div>\n        )\n    }\n}\nconst mapStateToProps = state => {\n    return {\n        userId: state.auth.userId,\n        channel: state.call.channel,\n        remoteStream: state.call.remoteStream,\n        localStream: state.call.localStream\n    }\n}\nconst mapDispatchToProps = dispatch => {\n    return {\n        callUser: (user, calltype) => dispatch(callActionCreators.callUser(user, callType))\n    }\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(Video);"]},"metadata":{},"sourceType":"module"}