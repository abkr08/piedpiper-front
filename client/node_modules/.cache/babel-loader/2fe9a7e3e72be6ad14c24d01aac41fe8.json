{"ast":null,"code":"import * as actionTypes from '../actions';\nimport { ChatManager, TokenProvider } from '@pusher/chatkit-client';\nimport axios from '../../../Axios';\nvar currentUser;\nvar user;\nexport var chatInit = function chatInit() {\n  return function (dispatch, getState) {\n    var userId = getState().auth.userId;\n    user = userId;\n    var chatManager = new ChatManager({\n      instanceLocator: 'v1:us1:64b7dbdb-3e59-4fad-9823-83add90cba65',\n      userId: userId,\n      tokenProvider: new TokenProvider({\n        url: 'https://us1.pusherplatform.io/services/chatkit_token_provider/v1/64b7dbdb-3e59-4fad-9823-83add90cba65/token'\n      })\n    });\n    chatManager.connect({\n      onAddedToRoom: function onAddedToRoom(room) {// this.getRooms();\n        // this.setState({showSideDrawer: false, room: room});\n        // this.getMessages(room);\n      }\n    }).then(function (user) {\n      currentUser = user;\n      dispatch(subscribeToRooms(currentUser));\n      dispatch(chatInitSuccess(currentUser));\n      dispatch(getRooms());\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n};\n\nvar getRooms = function getRooms() {\n  return function (dispatch) {\n    var contacts = currentUser.rooms.map(function (room) {\n      var obj = {}; //let contactNames = Object.keys(room).filter(key => console.log(key, user));\n      //let rtt = room.userIds.filter(name => name.length > 0)\n      //let {userIds} = room;\n\n      console.log(room.userIds.length);\n      obj.name = !room.isPrivate ? room.name : room.userIds.filter(function (name) {\n        return name == user;\n      }).join('');\n      obj.id = room.id;\n      var tes = Object.keys(room).map(function (key) {\n        return Array.isArray(key);\n      });\n      console.log(tes); // contacts.push(obj);\n\n      return obj;\n    });\n    console.log(contacts);\n    dispatch({\n      type: 'ON_ROOMS_FETCHED',\n      contacts: contacts\n    });\n  };\n};\n\nvar chatInitSuccess = function chatInitSuccess(currentUser) {\n  return {\n    type: actionTypes.CHAT_INIT_SUCCESS,\n    currentUser: currentUser\n  };\n};\n\nvar onNewMessage = function onNewMessage(message, belongsToCurrentRoom) {\n  return {\n    type: actionTypes.ON_NEW_MESSAGE,\n    message: message,\n    belongsToCurrentRoom: belongsToCurrentRoom\n  };\n};\n\nvar subscribeToRooms = function subscribeToRooms(user) {\n  return function (dispatch, getState) {\n    var contacts = user.rooms;\n    contacts.map(function (con) {\n      return user.subscribeToRoom({\n        roomId: con.id,\n        hooks: {\n          onMessage: function onMessage(message) {\n            var belongsToCurrentRoom = false;\n            var currentRoom = getState().chat.currentRoom;\n\n            if (currentRoom && currentRoom.id === message.roomId) {\n              belongsToCurrentRoom = true;\n            }\n\n            dispatch(onNewMessage(message, belongsToCurrentRoom));\n          }\n        },\n        messageLimit: 0\n      });\n    });\n  };\n};\n\nvar fetchMessagesSuccess = function fetchMessagesSuccess(messages, room) {\n  return {\n    type: actionTypes.FETCH_MESSAGES_SUCCESS,\n    messages: messages,\n    room: room\n  };\n};\n\nexport var getMessages = function getMessages(room) {\n  return function (dispatch) {\n    currentUser.fetchMessages({\n      roomId: room['id'],\n      //initialId: 42,\n      direction: 'older',\n      limit: 100\n    }).then(function (messages) {\n      dispatch(fetchMessagesSuccess(messages, room));\n    }).catch(function (err) {\n      console.log(\"Error fetching messages: \".concat(err));\n    });\n  };\n};\nexport var sendMessage = function sendMessage(data) {\n  return function (dispatch) {\n    currentUser.sendMessage(data);\n  };\n};\n\nvar createGroupSuccess = function createGroupSuccess() {\n  return {\n    type: actionTypes.CREATE_GROUP_SUCCESS\n  };\n};\n\nvar createGroupFailed = function createGroupFailed(err) {\n  return {\n    type: actionTypes.CREATE_GROUP_FAILED,\n    err: err\n  };\n};\n\nexport var createNewGroup = function createNewGroup(data) {\n  return function (dispatch) {\n    currentUser.createRoom({\n      name: data.name,\n      private: false,\n      addUserIds: data.participants,\n      customData: {\n        foo: 42\n      }\n    }).then(function (room) {\n      console.log(\"Created room called \".concat(room.name));\n      dispatch(createGroupSuccess());\n      dispatch(subscribeToRooms());\n    }).catch(function (err) {\n      console.log(\"Error creating room \".concat(err));\n      dispatch(createGroupFailed(err));\n    });\n  };\n};\n\nvar startNewChatSuccess = function startNewChatSuccess() {\n  return {\n    type: actionTypes.START_NEW_CHAT_SUCCESS\n  };\n};\n\nvar startNewChatFailed = function startNewChatFailed(err) {\n  return {\n    type: actionTypes.START_NEW_CHAT_FAILED,\n    err: err\n  };\n};\n\nexport var startNewChat = function startNewChat(data) {\n  return function (dispatch) {\n    var token = localStorage.getItem('token');\n    console.log(data);\n    axios.get(\"/search/\".concat(data.chatParticipant), {\n      headers: {\n        'x-auth-token': token\n      }\n    }).then(function (res) {\n      currentUser.createRoom({\n        name: \"\".concat(currentUser, \"and\").concat(data.chatParticipant),\n        private: true,\n        addUserIds: [data.chatParticipant],\n        customData: {\n          displayImage: res.data.avatar\n        }\n      }).then(function (res) {\n        console.log(res);\n        dispatch(startNewChatSuccess());\n        dispatch(subscribeToRooms());\n      }).catch(function (err) {\n        console.log(err);\n        dispatch(startNewChatFailed(err));\n      });\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n};\nexport var joinRoom = function joinRoom(roomId) {\n  return function (dispatch) {\n    currentUser.joinRoom({\n      roomId: roomId\n    }).then(function (room) {\n      console.log(\"Joined room with ID: \".concat(room.id));\n    }).catch(function (err) {\n      console.log(\"Error joining room \".concat(roomId, \": \").concat(err));\n    });\n  };\n};\nexport var deleteChat = function deleteChat(roomId) {\n  return function (dispatch) {\n    console.log(typeof roomId);\n    currentUser.leaveRoom({\n      roomId: roomId\n    }).then(function () {\n      console.log(\"Deleted room with ID: \".concat(roomId)); //dispatch(subscribeToRooms());\n      //   dispatch(chatInitSuccess());\n    }).catch(function (err) {\n      console.log(\"Error deleted room \".concat(roomId, \": \").concat(err));\n    });\n  };\n};","map":{"version":3,"sources":["/Users/gotzil/Desktop/Pied Piper Chat/client/src/store/actions/actionCreators/chatActionCreators.js"],"names":["actionTypes","ChatManager","TokenProvider","axios","currentUser","user","chatInit","dispatch","getState","userId","auth","chatManager","instanceLocator","tokenProvider","url","connect","onAddedToRoom","room","then","subscribeToRooms","chatInitSuccess","getRooms","catch","err","console","log","contacts","rooms","map","obj","userIds","length","name","isPrivate","filter","join","id","tes","Object","keys","key","Array","isArray","type","CHAT_INIT_SUCCESS","onNewMessage","message","belongsToCurrentRoom","ON_NEW_MESSAGE","con","subscribeToRoom","roomId","hooks","onMessage","currentRoom","chat","messageLimit","fetchMessagesSuccess","messages","FETCH_MESSAGES_SUCCESS","getMessages","fetchMessages","direction","limit","sendMessage","data","createGroupSuccess","CREATE_GROUP_SUCCESS","createGroupFailed","CREATE_GROUP_FAILED","createNewGroup","createRoom","private","addUserIds","participants","customData","foo","startNewChatSuccess","START_NEW_CHAT_SUCCESS","startNewChatFailed","START_NEW_CHAT_FAILED","startNewChat","token","localStorage","getItem","get","chatParticipant","headers","res","displayImage","avatar","joinRoom","deleteChat","leaveRoom"],"mappings":"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","sourcesContent":["import * as actionTypes from '../actions';\nimport { ChatManager, TokenProvider } from '@pusher/chatkit-client';\nimport axios from '../../../Axios';\n\nlet currentUser;\nlet user;\nexport const chatInit = () => { \n    return (dispatch, getState) => {\n        const {userId} = getState().auth;\n        user = userId;\n        const chatManager = new ChatManager({\n            instanceLocator: 'v1:us1:64b7dbdb-3e59-4fad-9823-83add90cba65',\n            userId: userId,\n            tokenProvider: new TokenProvider({\n                url: 'https://us1.pusherplatform.io/services/chatkit_token_provider/v1/64b7dbdb-3e59-4fad-9823-83add90cba65/token'\n            })\n        });    \n        chatManager\n        .connect({\n            onAddedToRoom: room => {\n                // this.getRooms();\n                // this.setState({showSideDrawer: false, room: room});\n                // this.getMessages(room);\n            }\n        })\n        .then(user => {\n            currentUser = user;\n            dispatch(subscribeToRooms(currentUser))\n            dispatch(chatInitSuccess(currentUser));\n            dispatch(getRooms());\n\n        })\n        .catch(err => console.log(err));\n    }\n}\nconst getRooms = () => {\n    return dispatch => {\n        const contacts = currentUser.rooms.map(room => {\n            let obj = {};\n            //let contactNames = Object.keys(room).filter(key => console.log(key, user));\n            //let rtt = room.userIds.filter(name => name.length > 0)\n            //let {userIds} = room;\n            console.log(room.userIds.length);\n            obj.name = !room.isPrivate ? room.name :\n                        room.userIds.filter(name => name == user).join('');\n            obj.id = room.id;\n            let tes = Object.keys(room).map(key => Array.isArray(key));\n            console.log(tes);\n            // contacts.push(obj);\n            return obj;\n        });\n        console.log(contacts);\n        dispatch({type: 'ON_ROOMS_FETCHED', contacts})\n    }\n}\nconst chatInitSuccess = currentUser => {\n    return {\n        type: actionTypes.CHAT_INIT_SUCCESS,\n        currentUser\n    }\n}\nconst onNewMessage = (message, belongsToCurrentRoom) => {\n    return {\n        type: actionTypes.ON_NEW_MESSAGE,\n        message,\n        belongsToCurrentRoom\n    }\n}\nconst subscribeToRooms = user => {\n    return (dispatch, getState) => {\n        const contacts = user.rooms;\n        contacts.map(con => {\n            return  user.subscribeToRoom({\n                 roomId: con.id,\n                 hooks: {\n                   onMessage: message => {\n                     let belongsToCurrentRoom = false;\n                     const { currentRoom } = getState().chat;\n                    if (currentRoom && currentRoom.id === message.roomId){\n                        belongsToCurrentRoom = true;\n                    } \n                    dispatch(onNewMessage(message, belongsToCurrentRoom));\n                   }\n                 },\n                 messageLimit: 0\n               })\n         })\n    }\n}\n\nconst fetchMessagesSuccess = (messages, room) => {\n    return {\n        type: actionTypes.FETCH_MESSAGES_SUCCESS,\n        messages,\n        room\n    }\n}\nexport const getMessages = room => {\n    return dispatch => {\n        currentUser.fetchMessages({\n            roomId: room['id'],\n            //initialId: 42,\n            direction: 'older',\n            limit: 100,\n          })\n            .then(messages => {\n              dispatch(fetchMessagesSuccess(messages, room));\n            })\n            .catch(err => {\n              console.log(`Error fetching messages: ${err}`);\n            })\n    }\n   \n}\nexport const sendMessage = data => {\n    return dispatch => {\n        currentUser.sendMessage(data);\n    }\n}\nconst createGroupSuccess = () => {\n    return {\n        type: actionTypes.CREATE_GROUP_SUCCESS\n    }\n}\nconst createGroupFailed = err => {\n    return {\n        type: actionTypes.CREATE_GROUP_FAILED,\n        err\n    }\n}\nexport const createNewGroup = data => {\n    return dispatch => {\n        currentUser.createRoom({\n            name: data.name,\n            private: false,\n            addUserIds: data.participants,\n            customData: { foo: 42 },\n          }).then(room => {\n            console.log(`Created room called ${room.name}`);\n            dispatch(createGroupSuccess());\n            dispatch(subscribeToRooms());\n          })\n          .catch(err => {\n            console.log(`Error creating room ${err}`);\n            dispatch(createGroupFailed(err));\n          })\n    }\n}\nconst startNewChatSuccess = () => {\n    return {\n        type: actionTypes.START_NEW_CHAT_SUCCESS\n    }\n}\nconst startNewChatFailed = err => {\n    return {\n        type: actionTypes.START_NEW_CHAT_FAILED,\n        err\n    }\n}\nexport const startNewChat = data => {\n    return dispatch => {\n        let token = localStorage.getItem('token');\n        console.log(data)\n        axios.get(`/search/${data.chatParticipant}`, {headers: {'x-auth-token': token}})\n            .then(res => {\n                currentUser.createRoom({\n                name: `${currentUser}and${data.chatParticipant}`,\n                private: true,\n                addUserIds: [data.chatParticipant],\n                customData: {displayImage: res.data.avatar}     \n            })\n                .then(res => {\n                    console.log(res);\n                    dispatch(startNewChatSuccess());\n                    dispatch(subscribeToRooms());\n                })\n                .catch(err => {\n                    console.log(err);\n                    dispatch(startNewChatFailed(err));\n                });\n            })\n            .catch(err => console.log(err));\n    }\n}\nexport const joinRoom = roomId => {\n    return dispatch => {    \n        currentUser.joinRoom({ roomId })\n            .then(room => {\n                console.log(`Joined room with ID: ${room.id}`)\n            })\n            .catch(err => {\n                console.log(`Error joining room ${roomId}: ${err}`)\n            })\n    }\n}\n\nexport const deleteChat = roomId => {\n    return dispatch => {\n        console.log(typeof roomId)\n        currentUser.leaveRoom({ roomId: roomId })\n        .then(() => {\n          console.log(`Deleted room with ID: ${roomId}`);\n          //dispatch(subscribeToRooms());\n        //   dispatch(chatInitSuccess());\n        })\n        .catch(err => {\n          console.log(`Error deleted room ${roomId}: ${err}`)\n        });\n    }\n}"]},"metadata":{},"sourceType":"module"}