{"ast":null,"code":"import _classCallCheck from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/gotzil/Downloads/social-media/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/gotzil/Downloads/social-media/client/src/containers/Video/Video.js\";\nimport React, { Component } from 'react';\nimport classes from './Video.module.css';\nimport pusher from '../../pusherConfig';\nimport { connect } from 'react-redux';\n\nvar Video =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Video, _Component);\n\n  function Video() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Video);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Video)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.gotLocalStream = function (mediaStream) {\n      _this.localStream = mediaStream;\n      _this.localVideoRef.srcObject = mediaStream;\n    };\n\n    _this.GetRTCIceCandidate = function () {\n      window.RTCIceCandidate = window.RTCIceCandidate || window.webkitRTCIceCandidate || window.mozRTCIceCandidate || window.msRTCIceCandidate;\n      return window.RTCIceCandidate;\n    };\n\n    _this.GetRTCPeerConnection = function () {\n      window.RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection || window.msRTCPeerConnection;\n      return window.RTCPeerConnection;\n    };\n\n    _this.GetRTCSessionDescription = function () {\n      window.RTCSessionDescription = window.RTCSessionDescription || window.webkitRTCSessionDescription || window.mozRTCSessionDescription || window.msRTCSessionDescription;\n      return window.RTCSessionDescription;\n    };\n\n    _this.prepareCaller = function () {\n      //Initializing a peer connection\n      _this.caller = new RTCPeerConnection();\n      console.log(_this.caller); //Listen for ICE Candidates and send them to remote peers\n\n      _this.caller.onicecandidate = function (evt) {\n        if (!evt.candidate) return; //   console.log(\"onicecandidate called\");\n        //   console.log(evt);\n\n        _this.onIceCandidate(_this.caller, evt);\n      }; //onaddstream handler to receive remote feed and show in remoteview video element\n\n\n      _this.caller.onaddstream = function (evt) {\n        console.log(\"onaddstream called\");\n        console.log(evt);\n        _this.remoteVideoRef.srcObject = evt.stream;\n      };\n    };\n\n    _this.onIceCandidate = function (peer, evt) {\n      if (evt.candidate) {\n        _this.channel.trigger(\"client-candidate\", {\n          \"candidate\": evt.candidate,\n          \"room\": _this.props.callTo\n        });\n      }\n    };\n\n    _this.getCam = function () {\n      //Get local audio/video feed and show it in selfview video element\n      return navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true\n      });\n    };\n\n    _this.callUser = function (user) {\n      _this.getCam().then(function (stream) {\n        _this.localVideoRef.srcObject = stream;\n        console.log(user, stream);\n\n        _this.toggleEndCallButton();\n\n        _this.caller.addStream(stream);\n\n        _this.localUserMedia = stream;\n\n        _this.caller.createOffer().then(function (desc) {\n          _this.caller.setLocalDescription(new RTCSessionDescription(desc));\n\n          _this.channel.trigger(\"client-sdp\", {\n            sdp: desc,\n            room: user,\n            from: _this.props.userId\n          }); //room = user;\n\n        });\n      }).catch(function (error) {\n        console.log(\"an error occured\", error);\n      });\n    };\n\n    _this.endCall = function () {\n      //room = undefined;\n      _this.caller.close();\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = _this.localUserMedia.getTracks()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var track = _step.value;\n          track.stop();\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      _this.prepareCaller();\n\n      _this.toggleEndCallButton();\n    };\n\n    _this.toggleEndCallButton = function () {// if (document.getElementById(\"endCall\").style.display == \"block\") {\n      //   document.getElementById(\"endCall\").style.display = \"none\";\n      // } else {\n      //   document.getElementById(\"endCall\").style.display = \"block\";\n      // }\n    };\n\n    return _this;\n  }\n\n  _createClass(Video, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.channel = pusher.subscribe('presence-videocall');\n      this.GetRTCPeerConnection();\n      this.GetRTCSessionDescription();\n      this.GetRTCIceCandidate(); //prepare the caller to use peerconnection\n\n      this.prepareCaller();\n      this.callUser(this.props.callTo);\n      this.channel.bind(\"client-candidate\", function (msg) {\n        if (msg.room) {\n          console.log(\"candidate received\");\n          this.caller.addIceCandidate(new RTCIceCandidate(msg.candidate));\n        }\n      });\n      this.channel.bind(\"client-sdp\", function (msg) {\n        if (msg.room == _this2.props.userId) {\n          var answer = window.confirm(\"You have a call from: \" + msg.from + \"Would you like to answer?\");\n\n          if (!answer) {\n            return _this2.channel.trigger(\"client-reject\", {\n              \"room\": msg.room,\n              \"rejected\": _this2.props.userId\n            });\n          } //room = msg.room;\n\n\n          _this2.getCam().then(function (stream) {\n            _this2.localUserMedia = stream;\n\n            _this2.toggleEndCallButton();\n\n            _this2.localVideoRef.srcObject = stream;\n\n            _this2.caller.addStream(stream);\n\n            var sessionDesc = new RTCSessionDescription(msg.sdp);\n\n            _this2.caller.setRemoteDescription(sessionDesc);\n\n            _this2.caller.createAnswer().then(function (sdp) {\n              _this2.caller.setLocalDescription(new RTCSessionDescription(sdp));\n\n              _this2.channel.trigger(\"client-answer\", {\n                \"sdp\": sdp,\n                \"room\": _this2.props.callTo\n              });\n            });\n          }).catch(function (error) {\n            console.log('an error occured', error);\n          });\n        }\n      });\n      this.channel.bind(\"client-answer\", function (answer) {\n        if (answer.room == _this2.props.callTo) {\n          console.log(\"answer received\");\n\n          _this2.caller.setRemoteDescription(new RTCSessionDescription(answer.sdp));\n        }\n      });\n      this.channel.bind(\"client-reject\", function (answer) {\n        if (answer.room == this.props.callTo) {\n          console.log(\"Call declined\");\n          alert(\"call to \" + answer.rejected + \"was politely declined\");\n          this.endCall();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return React.createElement(\"div\", {\n        className: classes.Video,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, React.createElement(\"video\", {\n        autoPlay: true,\n        muted: true,\n        className: classes.LocalVideo,\n        ref: function ref(lVid) {\n          return _this3.localVideoRef = lVid;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }), React.createElement(\"video\", {\n        autoPlay: true,\n        className: classes.remoteVideo,\n        ref: function ref(rVid) {\n          return _this3.remoteVideoRef = rVid;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Video;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    userId: state.userId\n  };\n};\n\nexport default connect(mapStateToProps)(Video);","map":{"version":3,"sources":["/Users/gotzil/Downloads/social-media/client/src/containers/Video/Video.js"],"names":["React","Component","classes","pusher","connect","Video","gotLocalStream","mediaStream","localStream","localVideoRef","srcObject","GetRTCIceCandidate","window","RTCIceCandidate","webkitRTCIceCandidate","mozRTCIceCandidate","msRTCIceCandidate","GetRTCPeerConnection","RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","msRTCPeerConnection","GetRTCSessionDescription","RTCSessionDescription","webkitRTCSessionDescription","mozRTCSessionDescription","msRTCSessionDescription","prepareCaller","caller","console","log","onicecandidate","evt","candidate","onIceCandidate","onaddstream","remoteVideoRef","stream","peer","channel","trigger","props","callTo","getCam","navigator","mediaDevices","getUserMedia","video","audio","callUser","user","then","toggleEndCallButton","addStream","localUserMedia","createOffer","desc","setLocalDescription","sdp","room","from","userId","catch","error","endCall","close","getTracks","track","stop","subscribe","bind","msg","addIceCandidate","answer","confirm","sessionDesc","setRemoteDescription","createAnswer","alert","rejected","LocalVideo","lVid","remoteVideo","rVid","mapStateToProps","state"],"mappings":"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","sourcesContent":["import React, { Component} from 'react';\nimport classes from './Video.module.css';\nimport pusher from '../../pusherConfig'; \nimport { connect } from 'react-redux';\nclass Video extends Component {\n    \n    componentDidMount () {\n        this.channel = pusher.subscribe('presence-videocall');\n        this.GetRTCPeerConnection();\n        this.GetRTCSessionDescription();\n        this.GetRTCIceCandidate();\n    //prepare the caller to use peerconnection\n        this.prepareCaller();\n        this.callUser(this.props.callTo);\n        this.channel.bind(\"client-candidate\", function(msg) {\n            if(msg.room){\n                console.log(\"candidate received\");\n                this.caller.addIceCandidate(new RTCIceCandidate(msg.candidate));\n            }\n        });\n\n        this.channel.bind(\"client-sdp\", msg => {\n            if(msg.room == this.props.userId){\n                var answer = window.confirm(\"You have a call from: \"+ msg.from + \"Would you like to answer?\");\n                if(!answer){\n                    return this.channel.trigger(\"client-reject\", {\"room\": msg.room, \"rejected\":this.props.userId});\n                }\n            \n                //room = msg.room;\n                this.getCam()\n                .then(stream => {\n                    this.localUserMedia = stream;\n                    this.toggleEndCallButton();\n                    \n                        this.localVideoRef.srcObject = stream;\n    \n                    this.caller.addStream(stream);\n                   let sessionDesc = new RTCSessionDescription(msg.sdp);\n                    this.caller.setRemoteDescription(sessionDesc);\n                    this.caller.createAnswer().then(sdp => {\n                        this.caller.setLocalDescription(new RTCSessionDescription(sdp));\n                        this.channel.trigger(\"client-answer\", {\n                            \"sdp\": sdp,\n                            \"room\": this.props.callTo\n                        });\n                    });\n    \n                }).catch(error => {\n                    console.log('an error occured', error);\n                });\n            }\n            });\n            this.channel.bind(\"client-answer\", answer =>  {\n                if (answer.room == this.props.callTo) {\n                  console.log(\"answer received\");\n                  this.caller.setRemoteDescription(new RTCSessionDescription(answer.sdp));\n                }\n              });\n          \n              this.channel.bind(\"client-reject\", function(answer) {\n                if (answer.room == this.props.callTo) {\n                  console.log(\"Call declined\");\n                  alert(\"call to \" + answer.rejected + \"was politely declined\");\n                  this.endCall();\n                }\n              });\n          \n            }\n        \n    gotLocalStream = mediaStream => {\n        this.localStream = mediaStream;\n        this.localVideoRef.srcObject = mediaStream;\n    }\n\n     GetRTCIceCandidate = () => {\n       window.RTCIceCandidate =\n        window.RTCIceCandidate ||\n        window.webkitRTCIceCandidate ||\n        window.mozRTCIceCandidate ||\n        window.msRTCIceCandidate;\n  \n        return window.RTCIceCandidate;\n      }\n  \n       GetRTCPeerConnection = () => {\n        window.RTCPeerConnection =\n        window.RTCPeerConnection ||\n        window.webkitRTCPeerConnection ||\n        window.mozRTCPeerConnection ||\n         window.msRTCPeerConnection;\n        return window.RTCPeerConnection;\n      }\n  \n       GetRTCSessionDescription = () => {\n        window.RTCSessionDescription =\n        window.RTCSessionDescription ||\n        window.webkitRTCSessionDescription ||\n        window.mozRTCSessionDescription ||\n        window.msRTCSessionDescription;\n        return window.RTCSessionDescription;\n      }\n       prepareCaller = () => {\n        //Initializing a peer connection\n        this.caller = new RTCPeerConnection();\n        console.log(this.caller);\n        //Listen for ICE Candidates and send them to remote peers\n        this.caller.onicecandidate = (evt) => {\n          if (!evt.candidate) return;\n        //   console.log(\"onicecandidate called\");\n        //   console.log(evt);\n          this.onIceCandidate(this.caller, evt);\n        };\n        //onaddstream handler to receive remote feed and show in remoteview video element\n        this.caller.onaddstream = (evt) => {\n          console.log(\"onaddstream called\");\n            console.log(evt);\n            this.remoteVideoRef.srcObject =  evt.stream;\n        \n        };\n      }\n      onIceCandidate = (peer, evt) => {\n        if (evt.candidate) {\n            this.channel.trigger(\"client-candidate\", {\n                \"candidate\": evt.candidate,\n                \"room\": this.props.callTo\n            });\n        }\n    }\n    getCam = () => {\n        //Get local audio/video feed and show it in selfview video element\n        return navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n      }\n      //Create and send offer to remote peer on button click\n       callUser = (user) => {\n        this.getCam()\n          .then(stream => {\n              this.localVideoRef.srcObject = stream;\n            console.log(user, stream);\n            this.toggleEndCallButton();\n            this.caller.addStream(stream);\n            this.localUserMedia = stream;\n            this.caller.createOffer().then((desc) => {\n              this.caller.setLocalDescription(new RTCSessionDescription(desc));\n              this.channel.trigger(\"client-sdp\", {\n                sdp: desc,\n                room: user,\n                from: this.props.userId\n              });\n              //room = user;\n            });\n          })\n          .catch(error => {\n            console.log(\"an error occured\", error);\n          });\n      }\n      endCall = () => {\n        //room = undefined;\n        this.caller.close();\n        for (let track of this.localUserMedia.getTracks()) {\n          track.stop();\n        }\n        this.prepareCaller();\n        this.toggleEndCallButton();\n      } \n       toggleEndCallButton = () => {\n        // if (document.getElementById(\"endCall\").style.display == \"block\") {\n        //   document.getElementById(\"endCall\").style.display = \"none\";\n        // } else {\n        //   document.getElementById(\"endCall\").style.display = \"block\";\n        // }\n      }\n    render () {\n        return (\n            <div className={classes.Video}>\n                <video autoPlay muted className={classes.LocalVideo} ref={(lVid)=> this.localVideoRef = lVid}  ></video>\n                <video autoPlay className={classes.remoteVideo} ref={(rVid)=> this.remoteVideoRef = rVid}  ></video>\n            </div>\n        )\n    }\n}\nconst mapStateToProps = state => {\n    return {\n        userId: state.userId\n    }\n}\nexport default connect(mapStateToProps)(Video);"]},"metadata":{},"sourceType":"module"}