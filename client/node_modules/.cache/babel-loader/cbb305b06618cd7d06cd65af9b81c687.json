{"ast":null,"code":"import pusher from '../../../pusherConfig';\nimport * as actionTypes from '../actions';\nvar channel = pusher.subscribe('presence-videocall');\n\nvar prepareCaller = function prepareCaller(channel, caller) {\n  return {\n    type: actionTypes.PREPARE_CALLER,\n    channel: channel,\n    caller: caller\n  };\n};\n\nvar onTrack = function onTrack(track) {\n  return {\n    type: actionTypes.ON_TRACK,\n    remoteStream: track.stream\n  };\n};\n\nexport var getCallerReady = function getCallerReady() {\n  return function (dispatch) {\n    var caller = new window.RTCPeerConnection({\n      'iceServers': [{\n        'urls': 'stun:stun.l.google.com:19302'\n      }]\n    });\n    console.log(caller);\n    dispatch(prepareCaller(channel, caller)); //Listen for ICE Candidates and send them to remote peers\n\n    caller.onicecandidate = function (evt) {\n      if (!evt.candidate) return;\n      console.log(\"onicecandidate called\");\n      console.log(evt);\n      onIceCandidate(caller, evt);\n    }; //onaddstream handler to receive remote feed and show in remoteview video element\n\n\n    caller.ontrack = function (evt) {\n      console.log(evt); //this.remoteVideoRef.srcObject = evt.stream;\n\n      dispatch(onTrack(evt));\n    };\n  };\n};\n\nvar onIceCandidate = function onIceCandidate(peer, evt) {\n  if (evt.candidate) {\n    channel.trigger(\"client-candidate\", {\n      candidate: evt.candidate // room: room\n\n    });\n  }\n};","map":{"version":3,"sources":["/Users/gotzil/Downloads/social-media/client/src/store/actions/actionCreators/callActionCreators.js"],"names":["pusher","actionTypes","channel","subscribe","prepareCaller","caller","type","PREPARE_CALLER","onTrack","track","ON_TRACK","remoteStream","stream","getCallerReady","dispatch","window","RTCPeerConnection","console","log","onicecandidate","evt","candidate","onIceCandidate","ontrack","peer","trigger"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,uBAAnB;AACA,OAAO,KAAKC,WAAZ,MAA6B,YAA7B;AAEA,IAAMC,OAAO,GAAGF,MAAM,CAACG,SAAP,CAAiB,oBAAjB,CAAhB;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACF,OAAD,EAAUG,MAAV,EAAqB;AACvC,SAAO;AACHC,IAAAA,IAAI,EAAEL,WAAW,CAACM,cADf;AAEHL,IAAAA,OAAO,EAAEA,OAFN;AAGHG,IAAAA,MAAM,EAAEA;AAHL,GAAP;AAKH,CAND;;AAOA,IAAMG,OAAO,GAAG,SAAVA,OAAU,CAAAC,KAAK,EAAI;AACrB,SAAM;AACFH,IAAAA,IAAI,EAAEL,WAAW,CAACS,QADhB;AAEFC,IAAAA,YAAY,EAAEF,KAAK,CAACG;AAFlB,GAAN;AAKH,CAND;;AAOA,OAAO,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAChC,SAAO,UAAAC,QAAQ,EAAI;AAClB,QAAMT,MAAM,GAAG,IAAIU,MAAM,CAACC,iBAAX,CAA6B;AAAC,oBAAa,CAAC;AAAC,gBAAO;AAAR,OAAD;AAAd,KAA7B,CAAf;AACGC,IAAAA,OAAO,CAACC,GAAR,CAAYb,MAAZ;AACHS,IAAAA,QAAQ,CAACV,aAAa,CAACF,OAAD,EAAUG,MAAV,CAAd,CAAR,CAHkB,CAInB;;AACAA,IAAAA,MAAM,CAACc,cAAP,GAAwB,UAAAC,GAAG,EAAI;AAC7B,UAAI,CAACA,GAAG,CAACC,SAAT,EAAoB;AACpBJ,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYE,GAAZ;AACAE,MAAAA,cAAc,CAACjB,MAAD,EAASe,GAAT,CAAd;AACD,KALD,CALmB,CAWnB;;;AACAf,IAAAA,MAAM,CAACkB,OAAP,GAAiB,UAAAH,GAAG,EAAI;AACtBH,MAAAA,OAAO,CAACC,GAAR,CAAYE,GAAZ,EADsB,CAE1B;;AACAN,MAAAA,QAAQ,CAACN,OAAO,CAACY,GAAD,CAAR,CAAR;AACG,KAJD;AAKC,GAjBD;AAkBH,CAnBM;;AAqBP,IAAME,cAAc,GAAG,SAAjBA,cAAiB,CAACE,IAAD,EAAOJ,GAAP,EAAe;AAClC,MAAIA,GAAG,CAACC,SAAR,EAAmB;AACjBnB,IAAAA,OAAO,CAACuB,OAAR,CAAgB,kBAAhB,EAAoC;AAClCJ,MAAAA,SAAS,EAAED,GAAG,CAACC,SADmB,CAElC;;AAFkC,KAApC;AAID;AACF,CAPH","sourcesContent":["import pusher from '../../../pusherConfig';\nimport * as actionTypes from '../actions';\n\nconst channel = pusher.subscribe('presence-videocall');\n\nconst prepareCaller = (channel, caller) => {\n    return {\n        type: actionTypes.PREPARE_CALLER,\n        channel: channel,\n        caller: caller,\n    }\n}\nconst onTrack = track => {\n    return{\n        type: actionTypes.ON_TRACK,\n        remoteStream: track.stream\n\n    }\n}\nexport const getCallerReady = () => {\n    return dispatch => {\n     const caller = new window.RTCPeerConnection({'iceServers':[{'urls':'stun:stun.l.google.com:19302'}]});\n        console.log(caller);\n     dispatch(prepareCaller(channel, caller));\n    //Listen for ICE Candidates and send them to remote peers\n    caller.onicecandidate = evt => {\n      if (!evt.candidate) return;\n      console.log(\"onicecandidate called\");\n      console.log(evt);\n      onIceCandidate(caller, evt);\n    };\n    //onaddstream handler to receive remote feed and show in remoteview video element\n    caller.ontrack = evt => {\n      console.log(evt);\n  //this.remoteVideoRef.srcObject = evt.stream;\n  dispatch(onTrack(evt));\n    };\n    }\n}\n\nconst onIceCandidate = (peer, evt) => {\n    if (evt.candidate) {\n      channel.trigger(\"client-candidate\", {\n        candidate: evt.candidate,\n        // room: room\n      });\n    }\n  }"]},"metadata":{},"sourceType":"module"}