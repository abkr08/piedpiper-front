(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){e.exports={SideDrawer:"SideDrawer_SideDrawer__dbIRY",Open:"SideDrawer_Open__2WcxM",Close:"SideDrawer_Close__g0gN6",PP:"SideDrawer_PP__2CF3U",divs:"SideDrawer_divs__1xfzY",RoomsList:"SideDrawer_RoomsList__2HbRj"}},141:function(e,t){},16:function(e,t,n){e.exports={Navbar:"Navbar_Navbar__aDuUt",navIcon:"Navbar_navIcon__2U2Hh",fa:"Navbar_fa__voAjJ",NavItem:"Navbar_NavItem__1tVnh",Brand:"Navbar_Brand__2R68w"}},160:function(e,t,n){},162:function(e,t,n){"use strict";n.r(t);var a,o,r=n(0),c=n.n(r),l=n(66),i=n.n(l),s=(n(88),n(4)),u=n(5),m=n(7),p=n(6),d=n(8),h=n(169),f=n(166),g=n(167),v=n(170),C=n(3),E=n(41),b=n.n(E),_=function(e){return c.a.createElement("button",{onClick:e.clicked,disabled:e.disabled,className:[b.a.Button,b.a[e.btnType]].join(" ")},e.children)},O=n(42),y=n.n(O),S=function(e){return c.a.createElement("div",{className:y.a.IncomingCall},c.a.createElement("span",null,"Incoming ",e.callType," call from ",e.caller),c.a.createElement("span",{className:y.a.Buttons},c.a.createElement(_,{clicked:e.acceptCall,btnType:"Success"},"Accept"),c.a.createElement(_,{clicked:e.rejectCall,btnType:"Danger"},"Reject")))},w=n(2),I=n(13),j=n(68),N=n.n(j),R=n(69),T=n.n(R).a.create({baseURL:"https://piedpiperchat.herokuapp.com/"}),k=function(e){return function(t){setTimeout(function(){localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("expiresIn"),t(A())},1e3*e)}},L=function(e){return{type:"LOG_IN_FAILED",error:e}},A=function(){return{type:"LOG_OUT"}},x=n(70),D=n.n(x),M=localStorage.getItem("userId"),P={},B=D()("https://piedpiperchat.herokuapp.com:8082"),U={iceServers:[{url:"stun:stun2.1.google.com:19302"}]},F=null;console.log(B),B.on("connection",function(){console.log("Connected to the signaling server")});B.on("message",function(e){console.log("Got message",e);var t,n,r,c=JSON.parse(e);switch(c.type){case"login":console.log("logged in");break;case"requestToCall":console.log("received a request from "+c.from),V(c.from);break;case"answerToRequest":console.log("received an answer from "+c.from),G(c.from);break;case"offer":n=c.offer,r=c.name,console.log("Accepting offer from "+a),o.setRemoteDescription(new RTCSessionDescription(n)),console.log("Creating and sending answer to "+a),o.createAnswer(function(e){o.setLocalDescription(e),J({type:"answer",answer:e,from:r})},function(e){alert("Error when creating an answer")});break;case"answer":!function(e,t){console.log("Accepting answer from "+t),o.setRemoteDescription(new RTCSessionDescription(e))}(c.answer,c.from);break;case"candidate":t=c.candidate,o.addIceCandidate(new RTCIceCandidate(t));break;case"leave":K()}}),B.onerror=function(e){console.log("Got error",e)};var G=function(e){o.createOffer(function(e){J({type:"offer",offer:e}),o.setLocalDescription(e)},function(e){alert("Error when creating an offer")})},V=function(e){a=e,wt.dispatch({type:"ON_INCOMING_CALL",callType:"video",caller:e}),(o=new RTCPeerConnection(U)).ontrack=function(e){console.log("got remote stream"),console.log(e),wt.dispatch(z(e))},console.log(o),o.onicecandidate=function(e){e.candidate&&J({type:"candidate",candidate:e.candidate})},q().then(H).catch(function(e){return console.log(e)})};function J(e){a&&(e.name=a),B.send(JSON.stringify(e))}var q=function(){return navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,frameRate:15},audio:!0})},H=function(e){console.log("Received local stream"),F=e,wt.dispatch(W(e)),e.getTracks().forEach(function(t){console.log(t),o.addTrack(t,e)})},z=function(e){return{type:"ON_TRACK",remoteStream:e.streams[0]}},W=function(e){return{type:"ON_LOCAL_STREAM",stream:e}};var X=function(){return{type:"END_CALL"}};function K(){a=null,F.getTracks().forEach(function(e){return e.stop()}),wt.dispatch(X()),o.close(),o.onicecandidate=null,o.onaddTrack=null}var Y,$=n(43),Z=function(){return function(e){e({type:"ON_ROOMS_FETCHED",contacts:Y.rooms.map(function(e){var t={},n=e.isPrivate?e.name.split("and").filter(function(e){return e!==Y.id}).join(""):e.name;return n.length?t.name=n:t.name=Y.id,t.id=e.id,Object(w.a)({},e,t)})})}},Q=function(e){return{type:"CHAT_INIT_SUCCESS",currentUser:e}},ee=function(e){return function(t,n){e.rooms.map(function(a){return e.subscribeToRoom({roomId:a.id,hooks:{onMessage:function(e){var a=!1,o=n().chat.currentRoom;o&&o.id===e.roomId&&(a=!0),t(function(e,t){return{type:"ON_NEW_MESSAGE",message:e,belongsToCurrentRoom:t}}(e,a))}},messageLimit:0})})}},te=function(e){return function(t){Y.fetchMessages({roomId:e.id,direction:"older",limit:100}).then(function(n){t(function(e,t){return{type:"FETCH_MESSAGES_SUCCESS",messages:e,room:t}}(n,e))}).catch(function(e){console.log("Error fetching messages: ".concat(e))})}},ne=n(21),ae=n.n(ne),oe=function(e){var t=null,n=[ae.a.InputElement];switch(e.invalid&&e.shouldValidate&&e.touched&&n.push(ae.a.Invalid),e.elementType){case"input":t=c.a.createElement("input",Object.assign({className:n.join(" ")},e.elementConfig,{value:e.value,name:e.name,onChange:e.changed}));break;case"textarea":t=c.a.createElement("textarea",Object.assign({className:n.join(" ")},e.elementConfig,{value:e.value,onChange:e.changed}));break;case"select":t=c.a.createElement("select",{className:n.join(" "),value:e.value,onChange:e.changed},e.elementConfig.options.map(function(e){return c.a.createElement("option",{key:e.value,value:e.value},e.displayValue)}));break;default:t=c.a.createElement("input",Object.assign({className:ae.a.InputElement},e.elementConfig,{value:e.value,onChange:e.changed}))}return c.a.createElement("div",{className:ae.a.Input},c.a.createElement("label",{className:ae.a.Label},e.label),t)},re=function(e,t){return Object(w.a)({},e,t)},ce=function(e,t){var n=!0;if(!t)return!0;if(t.required&&(n=""!==e.trim()&&n),t.minLength&&(n=e.length>=t.minLength&&n),t.maxLength&&(n=e.length<=t.maxLength&&n),t.isEmail){n=/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)&&n}if(t.isNumeric){n=/^\d+$/.test(e)&&n}return n},le=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={controls:{name:{elementType:"input",elementConfig:{placeholder:"Enter your full name",type:"text"},value:"",validation:{required:!0},valid:!1,touched:!1},email:{elementType:"input",elementConfig:{placeholder:"Enter your email",type:"email"},value:"",validation:{required:!0,isEmail:!0},valid:!1,touched:!1},username:{elementType:"input",elementConfig:{placeholder:"Enter username",type:"text"},value:"",validation:{required:!0},valid:!1,touched:!1},password:{elementType:"input",elementConfig:{placeholder:"Enter your password",type:"password"},value:"",validation:{required:!0,minLength:8},valid:!1,touched:!1},password2:{elementType:"input",elementConfig:{placeholder:"Confirm your password",type:"password"},value:"",validation:{required:!0,minLength:8,isEqual:!1},valid:!1,touched:!1}},formIsValid:!1},n.onChange=function(e,t){var a=e.target.value,o=re(n.state.controls[t],{value:a,touched:!0,valid:ce(a,n.state.controls[t].validation)}),r=re(n.state.controls,Object(I.a)({},t,o)),c=!0;for(var l in r)c=r[l].valid&&c;n.setState({controls:r,formIsValid:c})},n.onSubmit=function(e){e.preventDefault();var t=n.state.controls,a=t.password,o=t.password2;if(console.log(a.value,o.value),a.value!==o.value)alert("passwords do not match");else{var r=Object(w.a)({},n.state.controls),c={};for(var l in r)c[l]=r[l].value;n.props.onRegister(c)}},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){this.props.registrationSuccess&&this.props.history.push("/login")}},{key:"render",value:function(){var e=this,t=[];for(var n in this.state.controls)t.push({id:n,config:this.state.controls[n]});var a=t.map(function(t){return c.a.createElement(oe,{key:t.id,elementType:t.config.elementType,elementConfig:t.config.elementConfig,value:t.config.value,invalid:!t.config.valid,shouldValidate:t.config.validation,touched:t.config.touched,changed:function(n){return e.onChange(n,t.id)}})});return c.a.createElement("div",{className:N.a.RegisterBox},c.a.createElement("h2",null," Register "),c.a.createElement("form",{onSubmit:this.onSubmit},a,c.a.createElement(_,{btnType:"Success",disabled:!this.state.formIsValid},"Register")))}}]),t}(r.Component),ie=Object(C.b)(function(e){return{registrationSuccess:e.auth.registrationSuccess}},function(e){return{onRegister:function(t){return e(function(e){return function(t){T.post("/register",e).then(function(e){t({type:"ON_REGISTER"})}).catch(function(e){t(function(e){return{type:"ON_REGISTRATION_FAILED",error:e}}(e))})}}(t))}}})(le),se=n(163),ue=n(71),me=n.n(ue),pe=n(72),de=n.n(pe),he=function(e){var t="";return t=e.error?e.error.response.data.authError:e.message,c.a.createElement("div",{className:de.a.ErrorBox},t)},fe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={controls:{email:{elementType:"input",elementConfig:{placeholder:"Enter your email",type:"email"},value:"",validation:{required:!0,isEmail:!0},valid:!1,touched:!1},password:{elementType:"input",elementConfig:{placeholder:"Enter your password",type:"password"},value:"",validation:{required:!0,minLength:8},valid:!1,touched:!1}},formIsValid:!1},n.onChange=function(e,t){var a=e.target.value,o=re(n.state.controls[t],{value:a,touched:!0,valid:ce(a,n.state.controls[t].validation)}),r=re(n.state.controls,Object(I.a)({},t,o)),c=!0;for(var l in r)c=r[l].valid&&c;n.setState({controls:r,formIsValid:c})},n.onSubmit=function(e){e.preventDefault();var t=Object(w.a)({},n.state.controls),a={};for(var o in t)a[o]=t[o].value;n.props.onLogIn(a)},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=null;this.props.isLoggedIn&&(t=c.a.createElement(se.a,{to:"/"}));var n=[];for(var a in this.state.controls)n.push({id:a,config:this.state.controls[a]});var o=n.sort(function(e,t){return e.id.localeCompare(t.id)}).map(function(t){return c.a.createElement(oe,{key:t.id,elementType:t.config.elementType,elementConfig:t.config.elementConfig,value:t.config.value,invalid:!t.config.valid,shouldValidate:t.config.validation,touched:t.config.touched,changed:function(n){return e.onChange(n,t.id)}})});return c.a.createElement("div",{className:me.a.Login},t,c.a.createElement("h2",null," Login "),this.props.error&&c.a.createElement(he,{error:this.props.error}),c.a.createElement("form",{onSubmit:this.onSubmit},o,c.a.createElement(_,{btnType:"Success",disabled:!this.state.formIsValid},"Log in")))}}]),t}(r.Component),ge=Object(C.b)(function(e){return{isLoggedIn:null!==e.auth.token,error:e.auth.error}},function(e){return{onLogIn:function(t){return e(function(e){return function(t){T.post("/login",e).then(function(e){var n=e.data,a=n.userId,o=n.token,r=n.expiresIn,c=new Date((new Date).getTime()+1e3*r);localStorage.setItem("token",o),localStorage.setItem("userId",a),localStorage.setItem("expiresIn",c),t(function(e,t){return{type:"LOG_IN",token:e,userId:t}}(e.data.token,a)),t(k(r))}).catch(function(e){t(L(e))})}}(t))}}})(fe),ve=function(e){function t(){return Object(s.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.logout(),this.props.history.push("/")}},{key:"render",value:function(){return c.a.createElement("div",null)}}]),t}(r.Component),Ce=Object(C.b)(null,function(e){return{logout:function(){return e(function(e){localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("expiresIn"),e(A())})}}})(ve),Ee=n(165),be=n(16),_e=n.n(be),Oe=function(e){function t(){return Object(s.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(Ee.a,{to:"/"},c.a.createElement("div",{className:[_e.a.NavItem,_e.a.Brand].join(" ")},c.a.createElement("span",{"data-text":"PiperChat"}," "),"PiperChat"))),c.a.createElement("li",null,c.a.createElement(Ee.a,{to:"/login"},c.a.createElement("div",{className:_e.a.NavItem},c.a.createElement("span",{"data-text":"Login"}," "),"Login"))),c.a.createElement("li",null,c.a.createElement(Ee.a,{to:"/register"},c.a.createElement("div",{className:_e.a.NavItem},c.a.createElement("span",{"data-text":"Register"}," "),"Register"))));return this.props.isLoggedIn&&(e=c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(Ee.a,{to:"/"},c.a.createElement("div",{className:_e.a.NavItem},c.a.createElement("span",{"data-text":"PiperChat"}," "),"PiperChat"))),c.a.createElement("li",null,c.a.createElement(Ee.a,{to:"/logout"},c.a.createElement("div",{className:_e.a.NavItem},c.a.createElement("span",{"data-text":"Logout"}," "),"Logout"))))),c.a.createElement("div",{className:_e.a.Navbar},e)}}]),t}(r.Component),ye=Object(C.b)(function(e){return{isLoggedIn:null!==e.auth.token}})(Oe),Se=n(45),we=n(24),Ie=n.n(we),je=n(73),Ne=n.n(je),Re=n(74),Te=n.n(Re),ke=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={options:n.props.options||[]},n.hideOptions=function(e){n.optionsRef&&!n.optionsRef.contains(e.target)&&n.props.hideOptions()},n.optionClicked=function(e,t){switch(t.name){case"Archive chat":alert("Archive chat");break;case"Mute":alert("Mute");break;case"Exit group":case"Delete chat":n.props.deleteChat(n.props.roomId)}},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.hideOptions),window.onresize=this.props.hideOptions}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.hideOptions)}},{key:"render",value:function(){var e=this,t=null;return this.props.show&&(t=c.a.createElement("ul",{ref:function(t){return e.optionsRef=t},className:Te.a.OptionsDropbar,style:{top:this.props.position.y+"px",left:this.props.position.x-200+"px"}},this.state.options.map(function(t,n){return c.a.createElement("li",{key:n,onClick:function(n){return e.optionClicked(n,t)}},t.name)}))),t}}]),t}(r.Component),Le=Object(C.b)(null,function(e){return{deleteChat:function(t){return e(function(e){return function(t){console.log(typeof e),Y.leaveRoom({roomId:e}).then(function(){console.log("Deleted room with ID: ".concat(e))}).catch(function(t){console.log("Error deleted room ".concat(e,": ").concat(t))})}}(t))}}})(ke),Ae=Object(C.b)(function(e){return{userId:e.auth.userId}})(function(e){var t=Object(r.useState)(!1),n=Object(Se.a)(t,2),a=n[0],o=n[1],l=Object(r.useState)({}),i=Object(Se.a)(l,2),s=i[0],u=i[1],m=[Ie.a.Contact],p="";e.Active&&m.push(Ie.a.Active),e.unopenedMessages[e.id]&&(p=e.unopenedMessages[e.id].length);var d=null;return e.room&&(d=c.a.createElement("div",{className:m.join(" "),onClick:e.clicked},c.a.createElement("span",{className:Ie.a.ImageContainter},c.a.createElement("img",{src:Ne.a,alt:""})),c.a.createElement("div",null,c.a.createElement("p",null,e.room.name),c.a.createElement("p",null,e.lastMessage)),c.a.createElement("div",{className:Ie.a.FloatedRight},c.a.createElement("span",null,p),c.a.createElement("i",{onClick:function(e){e.stopPropagation();var t={};t.x=e.clientX+200,t.y=e.clientY,o(!0),u(t)},className:"fa fa-angle-down"}),a&&c.a.createElement(Le,{position:s,roomId:e.room.id,show:a,hideOptions:function(){o(!1),u({})},options:[{name:"Archive chat"},{name:"Mute"},{name:e.room.isPrivate?"Delete chat":"Exit group"},{name:"Pin chat"},{name:"Mark as unread"}]})))),d}),xe=n(25),De=n.n(xe),Me=function(e){var t=[De.a.Chat];return e.byCurrentUser&&(t=[De.a.ByCurrentUser]),c.a.createElement("div",{className:t.join("")},c.a.createElement("li",null,c.a.createElement("span",{className:De.a.Sender},e.sender),c.a.createElement("br",null),c.a.createElement("span",{className:De.a.Text},e.text)))},Pe=n(18),Be=n.n(Pe),Ue=n(14),Fe=n.n(Ue),Ge=n(75),Ve=n.n(Ge),Je=Object(C.b)(null,function(e){return{joinRoom:function(t){return e((n=t,function(e){Y.joinRoom({roomId:n}).then(function(e){console.log("Joined room with ID: ".concat(e.id))}).catch(function(e){console.log("Error joining room ".concat(n,": ").concat(e))})}));var n}}})(function(e){return c.a.createElement("span",{onClick:e.joinRoom(e.id),className:Ve.a.JoinableRoom},c.a.createElement("img",{src:e.groupImage,alt:""}),c.a.createElement("span",null,c.a.createElement("p",null,e.name),c.a.createElement("p",null,e.lastMessage)))}),qe=function(e){return c.a.createElement(c.a.Fragment,null,e.joinableRooms.map(function(e,t){return c.a.createElement(Je,{key:t,groupImage:e.groupImage,name:e.name,id:e.id,lastMessage:e.lastMessage})}))},He=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={showCreateForm:!1,showNewChatForm:!1,groupName:"",participants:[],potentialParticipants:[],newGroupChatParticipants:{},privateChatParticipant:"",joinableRooms:[],ShowJoinableRoomsList:!1,touched:!1,isValid:!1},n.createNewGroupHandler=function(){var e=n.props.user.rooms.filter(function(e){return e.isPrivate&&e.name!==n.props.userId}),t={};e.forEach(function(e){return t[e.name]=!1}),n.setState(function(n){return{showCreateForm:!n.showCreateForm,potentialParticipants:e,ShowJoinableRoomsList:!1,showNewChatForm:!1,newGroupChatParticipants:t}})},n.onChange=function(e){n.setState(Object(I.a)({},e.target.name,e.target.value))},n.onCreateNewGroup=function(e){e.preventDefault();var t=Object(w.a)({},n.state.newGroupChatParticipants),a=Object.keys(t).filter(function(e){return t[e]});n.props.onCreateNewGroup({participants:a,name:n.state.groupName}),n.setState({groupName:"",newGroupChatParticipants:{}})},n.startNewChatHandler=function(){n.setState(function(e){return{showNewChatForm:!e.showNewChatForm,ShowJoinableRoomsList:!1,showCreateForm:!1}})},n.onStartNewChat=function(e){e.preventDefault();var t={chatParticipant:n.state.privateChatParticipant};n.props.onStartNewChat(t)},n.joinGroup=function(){n.props.user.getJoinableRooms().then(function(e){n.setState(function(t){return{joinableRooms:e,ShowJoinableRoomsList:!t.ShowJoinableRoomsList,showCreateForm:!1,showNewChatForm:!1}})}).catch(function(e){console.log("Error getting joinable rooms: ".concat(e))})},n.onPPChange=function(e){var t=e.target,a=t.name,o=t.checked,r=Object(w.a)({},n.state.newGroupChatParticipants);r[a]=o,n.setState({newGroupChatParticipants:r})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=[Fe.a.SideDrawer,Fe.a.Close];return this.props.show&&(t=[Fe.a.SideDrawer,Fe.a.Open]),c.a.createElement("div",{className:t.join(" ")},c.a.createElement("div",{className:Fe.a.divs,onClick:this.createNewGroupHandler},"Create a new group"),c.a.createElement("form",{onSubmit:this.onCreateNewGroup,style:{display:this.state.showCreateForm?"block":"none"}},c.a.createElement(oe,{elementType:"input",elementConfig:{placeholder:"Enter group name",type:"text"},value:this.state.groupName,invalid:this.state.isTouched&&!this.state.isValid,shouldValidate:!0,touched:this.state.isTouched,name:"groupName",changed:function(t){return e.onChange(t,"groupName")}}),c.a.createElement("h3",null,"Add participants"),this.state.potentialParticipants.map(function(t,n){return c.a.createElement("span",{key:n,className:Fe.a.PP},c.a.createElement("input",{onChange:e.onPPChange,type:"checkbox",name:t.name,checked:e.state.newGroupChatParticipants[t.name]}),c.a.createElement("label",{htmlFor:t.name},t.name))}),c.a.createElement(_,{btnType:"Success"},"Create")),c.a.createElement("div",{className:Fe.a.divs,onClick:this.joinGroup},"Join a group"),c.a.createElement("span",{style:{display:this.state.ShowJoinableRoomsList?"block":"none"},className:Fe.a.RoomsList},c.a.createElement(qe,{joinableRooms:this.state.joinableRooms})),c.a.createElement("div",{className:Fe.a.divs,onClick:this.startNewChatHandler},"Start a new chat"),c.a.createElement("form",{onSubmit:this.onStartNewChat,style:{display:this.state.showNewChatForm?"block":"none"}},c.a.createElement("input",{onChange:this.onChange,type:"text",name:"privateChatParticipant",placeholder:"Who do you wanna chat with?"}),c.a.createElement("button",null,"Submit")))}}]),t}(r.Component),ze=Object(C.b)(function(e){return{token:e.auth.token,userId:e.auth.userId}},function(e){return{onCreateNewGroup:function(t){return e(function(e){return function(t){Y.createRoom({name:e.name,private:!1,addUserIds:e.participants,customData:{foo:42}}).then(function(e){console.log("Created room called ".concat(e.name)),t({type:"CREATE_GROUP_SUCCESS"}),t(ee())}).catch(function(e){console.log("Error creating room ".concat(e)),t(function(e){return{type:"CREATE_GROUP_FAILED",err:e}}(e))})}}(t))},onStartNewChat:function(t){return e(function(e){return function(t){var n=localStorage.getItem("token");console.log(e),T.get("/search/".concat(e.chatParticipant),{headers:{"x-auth-token":n}}).then(function(n){Y.createRoom({name:"".concat(Y.id,"and").concat(e.chatParticipant),private:!0,addUserIds:[e.chatParticipant],customData:{displayImage:n.data.avatar}}).then(function(e){console.log(e),t({type:"START_NEW_CHAT_SUCCESS"}),t(ee())}).catch(function(e){console.log(e),t(function(e){return{type:"START_NEW_CHAT_FAILED",err:e}}(e))})}).catch(function(e){return console.log(e)})}}(t))}}})(He),We=n(44),Xe=n.n(We),Ke=n(76),Ye=n.n(Ke),$e=(n(77),function(e){function t(){return Object(s.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=null;return this.props.show&&(e=c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:Ye.a.Modal},this.props.children))),e}}]),t}(r.Component)),Ze=n(22),Qe=n.n(Ze),et=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={id:null,room:null},n.endCall=function(){n.setState({room:null}),n.props.endCall(),n.props.role||n.props.closeModal()},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;"callee"===this.props.role?this.setState({room:this.props.caller}):(this.props.callUser(this.props.callTo,this.props.callType),this.setState({room:this.props.callTo})),this.props.channel.on("message",function(t){"leave"===JSON.parse(t).type&&(e.props.role||e.props.closeModal())})}},{key:"componentDidUpdate",value:function(){"video"===this.props.callType?(this.localVideoRef.srcObject=this.props.localStream,this.remoteVideoRef.srcObject=this.props.remoteStream):(this.localAudioRef.srcObject=this.props.localStream,this.remoteAudioRef.srcObject=this.props.remoteStream)}},{key:"render",value:function(){var e=this,t=null;return t="video"===this.props.callType?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:Qe.a.videoContainer},c.a.createElement("video",{className:Qe.a.LocalVideo,autoPlay:!0,muted:!0,ref:function(t){return e.localVideoRef=t}}),c.a.createElement("video",{className:Qe.a.RemoteVideo,autoPlay:!0,ref:function(t){return e.remoteVideoRef=t}}))):c.a.createElement(c.a.Fragment,null,c.a.createElement("audio",{autoPlay:!0,src:this.props.localStream,muted:!0,ref:function(t){return e.localAudioRef=t}}),c.a.createElement("audio",{autoPlay:!0,src:this.props.remoteStream,ref:function(t){return e.remoteAudioRef=t}})),c.a.createElement("div",{className:Qe.a.Call},t,c.a.createElement("div",{className:Qe.a.Buttons},c.a.createElement(_,{clicked:this.endCall,btnType:"Danger"},"End Call")))}}]),t}(r.Component),tt=Object(C.b)(function(e){return{userId:e.auth.userId,channel:e.call.channel,remoteStream:e.call.remoteStream,localStream:e.call.localStream,incomingCall:e.call.incomingCall,caller:e.call.caller}},function(e){return{callUser:function(t,n){return e(function(e,t){return a=e,P.type=t,console.log("calling "+e+"...."),function(e){(o=new RTCPeerConnection(U)).ontrack=function(e){console.log("got remote stream"),console.log(e),wt.dispatch(z(e))},console.log(o),o.onicecandidate=function(e){e.candidate&&J({type:"candidate",candidate:e.candidate})},q().then(H).catch(function(e){return console.log("getUserMedia() error: ".concat(e))}),e({type:"CALL_INIT"}),J({type:"requestToCall",from:M,to:a})}}(t,n))},endCall:function(){return e(function(e){console.log(a),J({type:"leave",name:a}),K()})}}})(et),nt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={showModal:!1,isVideo:!1,callType:"",showOptions:!1,position:{}},n.onVideoCallInit=function(){n.setState({showModal:!0,callType:"video",isVideo:!0})},n.onVoiceCallInit=function(){n.setState({showModal:!0,isVideo:!1,callType:"audio"})},n.showOptions=function(e){var t=Object(w.a)({},n.state.position);t.x=e.clientX,t.y=e.clientY,n.setState({showOptions:!0,position:t})},n.hideOptions=function(){n.setState({showOptions:!1,position:{}})},n.endCall=function(){n.setState({showModal:!1})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=null;return this.state.showOptions&&(t=c.a.createElement(Le,{hideOptions:this.hideOptions,position:this.state.position,show:this.state.showOptions,options:[{name:"Contact info"},{name:"Select messages"},{name:"Mute"},{name:"Clear messages"},{name:"Delete chat"}]})),c.a.createElement("div",{className:Xe.a.ChatScreenBar},c.a.createElement("div",null,c.a.createElement("img",{src:"https://ichef.bbci.co.uk/images/ic/720x405/p0517py6.jpg",alt:""}),c.a.createElement("span",null,this.props.room.name)),c.a.createElement("div",{className:Xe.a.FA},this.props.room.isPrivate&&c.a.createElement(c.a.Fragment,null,c.a.createElement("i",{onClick:this.onVideoCallInit,className:"fa fa-video"}),c.a.createElement("i",{onClick:this.onVoiceCallInit,className:"fa fa-phone"})),c.a.createElement("i",{className:"fa fa-ellipsis-v",onClick:function(t){return e.showOptions(t)}}),t),c.a.createElement($e,{show:this.state.showModal},this.state.callType?c.a.createElement(tt,{callTo:this.props.room.name,closeModal:this.endCall,callType:this.state.callType}):null))}}]),t}(r.Component),at=Object(C.b)(function(e){return{callEnded:e.call.callEnded,callStarted:e.call.callOngoing}})(nt),ot=n(78),rt=n.n(ot),ct=function(e){return c.a.createElement("div",{className:rt.a.Spinner},c.a.createElement("div",null),c.a.createElement("div",null))},lt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={text:"",showSideDrawer:!1,contacts:[]},n.scrollToBottom=function(){if(n.scrollRef&&n.props.messages.length>0){var e=n.scrollRef.children[n.scrollRef.children.length-1];e.scrollIntoView(),console.log(e)}},n.getMessages=function(e){n.props.getMessages(e),n.scrollToBottom()},n.onChange=function(e){n.setState({text:e.target.value})},n.onSubmit=function(e){e.preventDefault();var t={text:n.state.text,roomId:n.props.currentRoom.id};n.props.sendMessage(t),n.setState({text:""})},n.toggleSideDrawer=function(){n.setState(function(e){return{showSideDrawer:!e.showSideDrawer}})},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.chatInit(),this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;console.log(this.state.contacts);var t=c.a.createElement($e,{show:!0},c.a.createElement(ct,null));t=this.props.currentRoom?c.a.createElement("div",{className:Be.a.Chat},c.a.createElement(at,{room:this.props.currentRoom,endCall:this.props.endCall}),c.a.createElement("div",{className:Be.a.Msgs,ref:function(t){e.scrollRef=t}},this.props.messages.map(function(t){return c.a.createElement(Me,{sender:t.senderId,byCurrentUser:e.props.userId===t.senderId,text:t.text,key:t.id})})),c.a.createElement("form",{onSubmit:this.onSubmit},c.a.createElement("input",{onChange:this.onChange,value:this.state.text,name:"text",type:"text",placeholder:"Enter message"}))):c.a.createElement("div",{className:Be.a.Chat});var n=null;return this.props.chatkitUser&&(n=c.a.createElement("div",{className:Be.a.ContactsPane},c.a.createElement(ze,{show:this.state.showSideDrawer,user:this.props.chatkitUser}),c.a.createElement("div",{className:Be.a.MenuBar},c.a.createElement("i",{onClick:this.toggleSideDrawer,className:"fa fa-bars"})),c.a.createElement("h1",{style:{textAlign:"center"}},"Contacts"),this.props.contacts.length&&this.props.contacts.map(function(t){return c.a.createElement(Ae,{key:t.id,name:t.name,room:t,user:e.props.userId,unopenedMessages:e.props.unopenedMessages,Active:!!e.props.currentRoom&&t.id===e.props.currentRoom.id,clicked:function(){return e.getMessages(t)}})}))),c.a.createElement("div",{className:Be.a.ChatScreen},n,t)}}]),t}(r.Component),it=Object(C.b)(function(e){return{userId:e.auth.userId,channel:e.call.channel,chatkitUser:e.chat.currentUser,currentRoom:e.chat.currentRoom,messages:e.chat.messages,endCall:e.call.endCall,unopenedMessages:e.chat.unopenedMessages,contacts:e.chat.contacts}},function(e){return{chatInit:function(){return e(function(e,t){var n=t().auth.userId;n,new $.ChatManager({instanceLocator:"v1:us1:64b7dbdb-3e59-4fad-9823-83add90cba65",userId:n,tokenProvider:new $.TokenProvider({url:"https://us1.pusherplatform.io/services/chatkit_token_provider/v1/64b7dbdb-3e59-4fad-9823-83add90cba65/token"})}).connect({onAddedToRoom:function(e){Z(),te(e)}}).then(function(t){e(ee(Y=t)),e(Q(Y)),e(Z())}).catch(function(e){return console.log(e)})})},getMessages:function(t){return e(te(t))},sendMessage:function(t){return e(function(e){return function(t){Y.sendMessage(e)}}(t))}}})(lt),st=(n(160),n(79)),ut=n.n(st),mt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={showCallNotification:!1},n.acceptCall=function(){n.ringtoneRef.pause(),n.ringtoneRef.currentTime=0,n.props.callAccepted()},n.rejectCall=function(){n.ringtoneRef.pause(),n.ringtoneRef.currentTime=0,n.props.callRejected()},n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.onAuth(),this.props.isLoggedIn||this.props.history.push("/login")}},{key:"componentDidUpdate",value:function(){this.props.isLoggedIn&&(this.props.channel||this.props.getCallerReady())}},{key:"render",value:function(){var e=this,t=null;return this.props.isLoggedIn&&(this.props.incomingCall?(this.ringtoneRef.play(),t=c.a.createElement(S,{acceptCall:this.acceptCall,rejectCall:this.rejectCall,caller:this.props.caller,callType:this.props.callType})):t=this.props.callOngoing?c.a.createElement(c.a.Fragment,null,c.a.createElement($e,{show:!0},c.a.createElement(tt,{role:"callee",callType:this.props.callType})),c.a.createElement(it,null)):c.a.createElement(it,null)),c.a.createElement("div",null,c.a.createElement(ye,null),c.a.createElement("div",{className:"container"},t,c.a.createElement("audio",{src:ut.a,loop:!0,ref:function(t){return e.ringtoneRef=t}}),c.a.createElement(h.a,null,c.a.createElement(f.a,{path:"/register",component:ie}),c.a.createElement(f.a,{path:"/login",component:ge}),c.a.createElement(f.a,{path:"/logout",component:Ce}),!this.props.isLoggedIn&&c.a.createElement(g.a,{to:"/login"}))))}}]),t}(r.Component),pt=Object(v.a)(Object(C.b)(function(e){return{isLoggedIn:null!==e.auth.token,incomingCall:e.call.incomingCall,callType:e.call.callType,channel:e.call.channel,caller:e.call.caller,callOngoing:e.call.callOngoing}},function(e){return{onAuth:function(){return e(function(e){var t=localStorage.getItem("token");if(t){var n=new Date(localStorage.getItem("expiresIn"));n<=new Date?e(A):(e(function(e,t){return{type:"ON_AUTH",token:e,userId:t}}(t,localStorage.getItem("userId"))),e(k((n.getTime()-(new Date).getTime())/1e3)))}else e(A())})},getCallerReady:function(){return e(function(e){J({type:"login",name:M}),e({type:"PREPARE_CALLER",channel:B})})},callAccepted:function(){return e(function(e){J({type:"answerToRequest",to:a,from:M}),e({type:"CALL_ACCEPTED"})})},callRejected:function(){return e(function(e){e({type:"CALL_REJECTED"})})}}})(mt)),dt=n(168),ht=n(17),ft=n(81);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var gt={token:null,userId:null,registrationSuccess:!1,error:null},vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOG_IN":return Object(w.a)({},e,{token:t.token,userId:t.userId,error:null});case"LOG_OUT":return Object(w.a)({},e,{token:null,userId:null});case"ON_AUTH":return Object(w.a)({},e,{token:t.token,userId:t.userId});case"ON_REGISTER":return Object(w.a)({},e,{registrationSuccess:!0});case"LOG_IN_FAILED":return Object(w.a)({},e,{error:t.error});default:return e}},Ct={channel:null,remoteStream:null,localStream:null,incomingCall:!1,callType:null,caller:null,callOngoing:!1,callStarted:!1,callEnded:!1},Et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ct,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PREPARE_CALLER":return Object(w.a)({},e,{channel:t.channel});case"CALL_INIT":return Object(w.a)({},e,{callStarted:!0,callEnded:!1});case"ON_TRACK":return Object(w.a)({},e,{remoteStream:t.remoteStream});case"ON_LOCAL_STREAM":return Object(w.a)({},e,{localStream:t.stream});case"ON_INCOMING_CALL":return Object(w.a)({},e,{incomingCall:!0,callType:t.callType,caller:t.caller});case"CALL_ACCEPTED":return Object(w.a)({},e,{incomingCall:!1,callOngoing:!0});case"CALL_REJECTED":return Object(w.a)({},e,{incomingCall:!1,callOngoing:!1});case"END_CALL":return Object(w.a)({},e,{callOngoing:!1,incomingCall:!1,callEnded:!0,callStarted:!1});default:return e}},bt=n(82),_t={currentUser:null,contacts:[],currentRoom:null,messages:[],unopenedMessages:{}},Ot=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_t,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"CHAT_INIT_SUCCESS":return Object(w.a)({},n,{currentUser:a.currentUser});case"FETCH_MESSAGES_SUCCESS":return Object(w.a)({},n,{messages:a.messages,currentRoom:a.room,unopenedMessages:(e=n.unopenedMessages,t=a.room.id,Object.keys(e).reduce(function(n,a){return a!==t?Object(w.a)({},n,Object(I.a)({},a,e[a])):n},{}))});case"ON_NEW_MESSAGE":if(a.belongsToCurrentRoom)return Object(w.a)({},n,{messages:[].concat(Object(bt.a)(n.messages),[a.message])});var o=Object(w.a)({},n.unopenedMessages);return o.hasOwnProperty(a.message.roomId)?o[a.message.roomId].push(a.message):o[a.message.roomId]=[a.message],Object(w.a)({},n,{unopenedMessages:o});case"ON_ROOMS_FETCHED":return Object(w.a)({},n,{contacts:a.contacts});default:return n}};n.d(t,"store",function(){return wt});var yt=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ht.d,St=Object(ht.c)({auth:vt,call:Et,chat:Ot}),wt=Object(ht.e)(St,yt(Object(ht.a)(ft.a)));i.a.render(c.a.createElement(C.a,{store:wt},c.a.createElement(dt.a,null,c.a.createElement(pt,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},18:function(e,t,n){e.exports={ChatScreen:"ChatScreen_ChatScreen__3NJNg",ContactsPane:"ChatScreen_ContactsPane__2wBCJ",MenuBar:"ChatScreen_MenuBar__xjjtB",Chat:"ChatScreen_Chat__9S2DJ",Msgs:"ChatScreen_Msgs__20qJ1"}},21:function(e,t,n){e.exports={Input:"Input_Input__1qkWX",Label:"Input_Label__22HBZ",InputElement:"Input_InputElement__3x11B",Invalid:"Input_Invalid__2JnXU"}},22:function(e,t,n){e.exports={Call:"Call_Call__3pF_p",videoContainer:"Call_videoContainer__pOd87",RemoteVideo:"Call_RemoteVideo__6iJ4d",Buttons:"Call_Buttons__x6xtm",LocalVideo:"Call_LocalVideo__277KJ"}},24:function(e,t,n){e.exports={Contact:"Contact_Contact__I6ygz",Active:"Contact_Active__1q391",ImageContainer:"Contact_ImageContainer__15hN_",FloatedRight:"Contact_FloatedRight__267zm"}},25:function(e,t,n){e.exports={Chat:"Chat_Chat__3TzaC",ByCurrentUser:"Chat_ByCurrentUser__3isyZ",Sender:"Chat_Sender__1gXJ1",Text:"Chat_Text__VVd_1"}},41:function(e,t,n){e.exports={Button:"Button_Button__2TE34",Success:"Button_Success__2n8wq",Danger:"Button_Danger__2Kz76"}},42:function(e,t,n){e.exports={IncomingCall:"IncomingCall_IncomingCall__1wsfq",Buttons:"IncomingCall_Buttons__6-Lpq"}},44:function(e,t,n){e.exports={ChatScreenBar:"ChatScreenBar_ChatScreenBar__3nwU6",FA:"ChatScreenBar_FA__sok0_"}},68:function(e,t,n){e.exports={RegisterBox:"Register_RegisterBox__30el9",registerBox:"Register_registerBox__TyBGA"}},71:function(e,t,n){e.exports={Login:"Login_Login__2hIs6"}},72:function(e,t,n){e.exports={ErrorBox:"ErrorBox_ErrorBox__wKH58"}},73:function(e,t,n){e.exports=n.p+"static/media/p37605.8335e87d.png"},74:function(e,t,n){e.exports={OptionsDropbar:"OptionsDropbar_OptionsDropbar__2KLcm"}},75:function(e,t,n){e.exports={JoinableRoom:"JoinableRoom_JoinableRoom__1Zws2"}},76:function(e,t,n){e.exports={Modal:"Modal_Modal__3o5hh"}},77:function(e,t,n){e.exports={Backdrop:"Backdrop_Backdrop__3FbGv"}},78:function(e,t,n){e.exports={Spinner:"Spinner_Spinner__dxPXP"}},79:function(e,t,n){e.exports=n.p+"static/media/iphone_trap_remix.d21333e9.mp3"},83:function(e,t,n){e.exports=n(162)},88:function(e,t,n){}},[[83,2,1]]]);
//# sourceMappingURL=main.79b51d00.chunk.js.map